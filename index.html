<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8"> <!-- Кодировка документа -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Подгонка под размеры экрана устройства -->
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script> <!-- Подключение библиотеки Telegram Web App -->
    
    <title>Telegram Web App</title> <!-- Заголовок страницы -->
    <style>
        /* CSS для стилизации элементов */
        .loading-screen {
            display: flex; /* Используем флексбокс для центрирования содержимого */
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; /* Высота на весь экран */
            background: #f0f0f0; /* Фоновый цвет во время загрузки */
        }
        /* Положение для аватара с кнопкой профиля */
        .avatar-container {
            position: relative; /* Относительное позиционирование для блока с аватаром */
        }

        .profile-button {
            display: none; /* Скрыть кнопку по умолчанию */
            position: absolute; /* Абсолютное позиционирование относительно контейнера */
            top: 0; /* Положение сверху */
            left: 0; /* Положение слева */
            background-color: #3b5998; /* Фоновый цвет кнопки */
            color: white; /* Цвет текста кнопки */
            padding: 5px 10px; /* Отступы кнопки */
            border-radius: 5px; /* Скругление углов */
            cursor: pointer; /* Изменение курсора на указатель */
        }

        .nav-buttons { /* Стили для панели навигации */
            display: flex;
            justify-content: space-around; /* Отступы между кнопками */
            margin-top: 20px; 
        }
      
        .modal {
            display: none; /* Модальное окно скрыто по умолчанию */
            position: fixed; /* Фиксированное позиционирование */
            z-index: 1; /* Положение выше других элементов */
            left: 0; 
            top: 0; 
            width: 100%; 
            height: 100%; 
            background-color: rgba(0, 0, 0, 0.4); /* Полупрозрачный фон */
        }

        .modal-content {
            background-color: #fff; /* Цвет фона для содержимого модального окна */
            margin: 15% auto; /* Центрирование модального окна */
            padding: 20px; 
            border: 1px solid #888; 
            width: 80%; 
        }
    </style>
</head>
<body>
    <div id="loadingScreen" class="loading-screen">
        <img src="https://example.com/loading-image.png" alt="Загрузка..."> <!-- Изображение загрузки -->
        <h2>Загрузка данных...</h2> <!-- Текст, отображаемый во время загрузки -->
    </div>

    <header>
        <div class="avatar-container"> <!-- Контейнер для аватара -->
            <img id="userAvatar" class="avatar" alt="Avatar" src="https://via.placeholder.com/80"> <!-- Аватар пользователя -->
            <div id="profileButton" class="profile-button">Профиль</div> <!-- Кнопка для открытия профиля -->
        </div>
        <div class="balance"> <!-- Блок с отображением баланса -->
            <img src="https://img.icons8.com/ios-filled/50/ffffff/coin-dollar.png" class="coin-icon" alt="Coin"> <!-- Иконка монеты -->
            <span id="userBalance">0 ₽</span> <!-- Значение баланса -->
        </div>
    </header>

    <div id="usercard">Загрузка данных...</div> <!-- Блок для отображения данных пользователя -->

    <!-- Модальное окно профиля -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span> <!-- Кнопка закрытия модального окна -->
            <h2>Профиль пользователя</h2> <!-- Заголовок модального окна -->
            <div>
                <img src="" id="profileAvatar" alt="Avatar" style="width: 80px; height: 80px; border-radius: 50%;"> <!-- Аватар в модальном окне -->
            </div>

            <p><strong>Фамилия:</strong> <span id="profileLastName"></span></p> <!-- Фамилия пользователя -->
            <p><strong>ID:</strong> <span id="profileId"></span></p> <!-- ID пользователя -->
            <p><strong>Пользователь:</strong> <span id="profileUsername"></span></p> <!-- Имя пользователя в системе -->
        </div>
    </div>

    <!-- Нижние кнопки навигации -->
    <div class="nav-buttons">
        <div class="nav-button" id="shopButton">Магазин</div> <!-- Кнопка "Магазин" -->
        <div class="nav-button" id="earnButton">Заработать</div> <!-- Кнопка "Заработать" -->
        <div class="nav-button" id="bonusButton">Бонусы</div> <!-- Кнопка "Бонусы" -->
        <div class="nav-button" id="moreButton">Другое</div> <!-- Кнопка "Другое" -->
    </div>

    <script>
        const tg = window.Telegram.WebApp; // Инициализация объекта для взаимодействия с Telegram Web App

        // Получаем и отображаем данные пользователя
        async function displayUserData(user) {
            document.getElementById('userAvatar').src = user.avatar || 'https://via.placeholder.com/80'; // Установка аватара пользователя
            document.getElementById('userBalance').innerText = `${user.balance} ₽`; // Отображение баланса 
            document.getElementById('profileAvatar').src = user.avatar || 'https://via.placeholder.com/80'; // Установка аватара в модальном окне
            document.getElementById('profileName').innerText = user.firstName; // Имя в модальном окне
            document.getElementById('profileLastName').innerText = user.lastName || ''; // Фамилия в модальном окне
            document.getElementById('profileId').innerText = user.userId; // ID пользователя в модальном окне
            document.getElementById('profileUsername').innerText = user.username || 'Не указан'; // Имя пользователя

            const userCard = document.getElementById('usercard'); // Блок для отображения данных пользователя
            userCard.innerHTML = `
                <img src="${user.avatar || 'https://via.placeholder.com/80'}" alt="Avatar"> <!-- Аватар в карточке -->
                <h3>${user.firstName} ${user.lastName || ''}</h3> <!-- Имя и фамилия в карточке -->
                <p><strong>Пользователь:</strong> ${user.username || 'Не указан'}</p> <!-- Имя пользователя -->
                <p><strong>Баланс:</strong> ${user.balance} ₽</p> <!-- Баланс пользователя -->
            `;
            userCard.style.display = 'block'; // Показываем карточку пользователя
            document.getElementById('loadingScreen').style.display = 'none'; // Скрываем экран загрузки
        }

        // Получение данных пользователя
        async function getUserData() {
            const userId = tg.initDataUnsafe.user.id; // Получение ID пользователя
            const firstName = tg.initDataUnsafe.user.first_name; // Получение имени пользователя
            const lastName = tg.initDataUnsafe.user.last_name || ''; // Получение фамилии пользователя
            const username = tg.initDataUnsafe.user.username || ''; // Получение имени пользователя в системе
            const avatar = tg.initDataUnsafe.user.photo_url || 'https://via.placeholder.com/80'; // Получение URL аватара

            const userData = {
                userId,
                firstName,
                lastName,
                username,
                avatar,
                balance: 1000 // Начальный баланс
            };

            await displayUserData(userData); // Отображение данных пользователя
        }

        document.addEventListener('DOMContentLoaded', getUserData); // Получение данных пользователя после загрузки страницы

        // Обработка нажатия на кнопки
        document.getElementById('shopButton').onclick = () => alert('Открытие магазина...'); // Уведомление при нажатии "Магазин"
        document.getElementById('earnButton').onclick = () => alert('Заработок активирован...'); // Уведомление при нажатии "Заработать"

        document.getElementById('moreButton').onclick = () => alert('Дополнительные функции...'); // Уведомление при нажатии "Другое"

        // Открытие модального окна профиля при нажатии на карточку пользователя
        document.getElementById('usercard').onclick = function() {
            document.getElementById('profileModal').style.display = 'block'; // Показываем модальное окно при клике
        };

        // Закрытие модального окна при нажатии на кнопку закрытия
        document.getElementById('closeModal').onclick = function() {
            document.getElementById('profileModal').style.display = 'none'; // Скрываем модальное окно
        };

        // Закрытие модального окна при клике вне области модального окна
        window.onclick = function(event) {
            const modal = document.getElementById('profileModal'); // Получаем модальное окно
            if (event.target === modal) {
                modal.style.display = 'none'; // Скрываем модальное окно при клике вне его
            }
        };

        // Добавление события нажав на аватар, чтобы показать кнопку "Профиль"
        const userAvatar = document.getElementById('userAvatar');
        userAvatar.onclick = function() {
            const profileButton = document.getElementById('profileButton'); // Получаем кнопку профиля
            profileButton.style.display = 'block'; // Показываем кнопку при нажатии на аватар
        };

        // Скрыть кнопку профиля при странном повторном нажатии
        document.getElementById('userAvatar').addEventListener('click', function() {
            const profileButton = document.getElementById('profileButton'); // Получаем кнопку профиля
            profileButton.style.display = profileButton.style.display === 'block' ? 'none' : 'block'; // Сменяем видимость кнопки
        });
    </script>
</body>
</html>
